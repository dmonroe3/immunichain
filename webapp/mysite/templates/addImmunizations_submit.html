{% extends 'base.html' %}
{% load staticfiles %}

{% block content %}
	<h2>Add Immunizations</h2>
	{% if existing_record.0.name != 'default'%}
		<h4>{{child_name}} already has the following vaccinations:</h4>
			<ul style="list-style-type:square">
				{% for field in existing_record %}
					<li><strong>Name</strong>: {{field.name}}, <strong>Provider</strong>: {{meddict|get_item:field.provider}}, <strong>Date</strong>: {{field.imdate}}</li>
				{% endfor %}
			</ul>
	{% endif %}
	<form method="post">
	<h3>Add Immunizations for {{child_name}}</h3>
	{% csrf_token %}
		<input type="hidden" name="child" value={{cid}}>
		{{ Immunirecord.management_form }}
		{% for link_form in Immunirecord %}
			<p>
				<div class="immunirecord">
		            {{ link_form.name }}
		            {% if link_form.name.errors %}
		                {% for error in link_form.name.errors %}
		                    {{ error|escape }}
		                {% endfor %}
		            {% endif %}

		            {{ link_form.date }}
		            {% if link_form.date.errors %}
		                {% for error in link_form.date.errors %}
		                    {{ error|escape }}
		                {% endfor %}
		            {% endif %}
		        </div>			
			</p>
	    {% endfor %}

        {% if Immunirecord.non_form_errors %}
        	<p>
	        {% for error in Immunirecord.non_form_errors %}
	            {{ error|escape }}
	        {% endfor %}
	        </p>
	        {% if Immunirecord.non_form_errors.0 == 'You need to submit at least one record.'%}
	        	<a href="{%url 'addImmun'%}">Try Again</a>
	        {% else %}
	    	<input type="submit" value="Submit" class="button" />
	    	{% endif %}

	    {% else %}
	    	<input type="submit" value="Submit" class="button" />
	    {% endif %}
	</form>

<!-- Include formset plugin - including jQuery dependency -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="/static/jquery.formset.js"></script>
<script>
    $('.immunirecord').formset({
        addText: 'Add more',
        deleteText: 'Remove'
    });
</script>	

{% endblock %}


